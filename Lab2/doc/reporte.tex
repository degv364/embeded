\input{../../general/doc/preamble.tex}
\begin{document}
%Header-Make sure you update this information!!!!
\noindent
\large\textbf{Laboratorio II: reporte} \hfill Laboratorio de sistemas Incrustados \\
\normalsize Esteban Zamora Alvarado \hfill Carné: B47769 \\
Daniel Esteban García Vaglio \hfill Carné: B42781 \\
Profesor: Esteban Ortiz  \hfill Fecha: 19-Octubre-2017 \\

\section{Problema a Resolver}

Utilizar la tarjeta MSP432 junto con el kit de expansión para desarrollar un indicador
de atitud. Este debe ser presentado al usuario por medio de la pantalla LCD que ya está incorporada
al kit de expansión. Debe ser capaz de indicar el pitch y el roll con una velocidad máxima de 90
grados por segundo y un rango máximo de 180 grados.  

\section{Contexto de Mercado}


\section{Solución Propuesta}

Como se deben realizar varias tareas de forma simultánea se propone la utilización de un scheduler
simple. Esto es un programa que se encarga de decidir qué tareas se deben ser ejecutadas y de la
sincronización general de las mismas. De esta manera se garantiza el cumplimiento de las
restricciones de temporización de cada proceso. Este scheduler permite el paso de mensajes entre las
tareas que debe sincronizar y además proporciona un método para reservar memoria para la
transferencia de datos por mensajes. También soporta 2 tipos de tareas, las que son periódicas, que
el scheduler debe ejecutar cada cierto tiempo, y las que son one shot, que el scheduler debe
ejecutar cada vez que sucede cierto evento.

El sistema que soluciona este laboratorio toma los datos de la dirección del vector de gravedad y a
partir de ellos calcula el Pitch y el Roll. Luego eso lo transforma en una ecuación lineal que es la
que define cómo se deben dibujar los colores en la pantalla LCD. Sobre la ecuación se dibuja azul, y
debajo se dibuja café. 

\section{Configuración de periféricos}

\subsection{Timer}

\subsection{Sensor de luz con I2C}


\subsection{ ADC}

\subsection{Acelerómetro}

%--------------------------------
\section{Implementación}
%-------------------------------
La implementación del código se encuentra disponible en  \url{https://github.com/degv364/embeded}.


\subsection{Scheduler}
\label{sec:scheduler}
El scheduler tiene como miembro un arreglo de tasks (sección \ref{sec:tasks}). Estas son todas las
tareas que puede ejecutar pero no necesariamente las ejecuta todas en cada frame. La prioridad de
ejecución se define por el nombre del task. Esto se hace aprovechando el hecho que el nombre se
implementa como un enum y por lo tanto ya tiene un orden intrínseco, cuanto menor se el valor del
enum, mayor es la prioridad. El nombre del task define la posición dentro del arreglo de tasks que
tiene el scheduler. De esta manera se optimiza bastante los procesos de búsqueda y ordenamiento de
tasks ($O(1)$).

El scheduler le agrega a cada task información extra. Primero agrega un contador que en el caso de
las tareas periódicas indica cuántos frames faltan para que la tarea se deba ejecutar de nuevo . El
otro dato es una bandera que indica si el task debe ser ejecutado al siguiente frame.

En cada frame se itera por las tareas y se ejecutan en caso que su bandera de ejecución esté
activada. Cabe destacar que como los tasks se indexan por nombre, que a su vez indica la
prioridad. Siempre se ejecutan primero los tasks de mayor prioridad. También durante el postamble se
atienden los tasks de mayor prioridad primero. 

Las tareas misceláneas del scheduler se ejecutan durante el postamble. Primero se itera por todos
los tasks y se toman los mensajes que colocaron en su message\_queue de salida, y se pasan a los
tasks destinatarios. En caso que sean para el scheduler, se guardan en el message\_queue
interno. También se actualizan los contadores para ejecución de los tasks periódicos, y se les
activa la bandera de ejecución en caso que sea necesario. Luego se procesan los mensajes internos.
Hay un tipo de mensaje que le indica al scheduler que agregue un task específico a la ejecución del
siguiente frame. Este es el único método para ejecutar tasks del tipo one\_shot.


\subsection{Tasks}
\label{sec:tasks}

Todos los tasks tienen un nombre, que define su prioridad. Además, en el caso de los tasks
periódicos se les define un periodo. Los message\_queque de salida y de entrada se utilizan para
enviar y recibir mensajes respectivamente.

El método de setup se encarga de inicializar varios miembros de la clase. Además se solicita al heap
una porción de memoria para ser utilizada para el paso de mensajes. Durante el método de run, se
revisan los mensajes entrantes y se atienden, luego se ejecutan las tareas propias del task.

\subsubsection{Task: IRQ\_alocator}
\label{sec:IRQ_allocator}

\subsubsection{Task: Calc angle}
\label{sec:calc_angle}


\subsubsection{Task: LCD issue}
\label{sec:lcd_issue}
\subsubsection{Task: LCD draw}
\label{sec:lcd_draw}


\subsection{Driver optimizado}
Driverlib ofrece un API para accesar a la pantalla LCD. 

%-------------------------------
\section{Problemas encontrados y posibles mejoras}
% -------------------------------


%----------------------
\textbf{ Bibliografía}
% ----------------------

Technical Reference manual, MSP432P4XX Simple Link Microcontrollers. Texas Instruments. Marzo 2017.

MSP432 Peripheral Driver Library. Users Guide. Texas Instruments. 2015.

BOOSTXL-EDUMKII Educational BoosterPack, Module Mark II. Texas Instruments. Marzo 2017.


%\bibliographystyle{apacite}
%\bibliography{../general/biblografia.bib}
%---------------------------------------------------------------------------------------------------------------
\end{document}